openapi: 3.0.3
info:
  title: NONGKIS API
  description: |
    **NONGKIS** - Platform Booking Tempat Nongkrong di Palu
    
    Fitur: Multi-role (User/Owner/Admin), Smart Hours, Auto Geocoding
    Flow: User booking → Owner approve → Selesai
  version: 1.0.0
  contact:
    name: Alif Apriansyah
    email: alifapriansyah246@gmail.com

servers:
  - url: http://localhost:3333

tags:
  - name: Authentication
    description: Login dan register
  - name: Users
    description: User management
  - name: Places
    description: Place management
  - name: Bookings
    description: Booking system
  - name: Time
    description: Time API
  - name: Maps
    description: Maps API

paths:
  # Auth
  /auth/register:
    post:
      tags: [Authentication]
      summary: Register user/owner/admin
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [name, email, password]
              properties:
                name:
                  type: string
                email:
                  type: string
                password:
                  type: string
                role:
                  type: string
                  enum: [user, owner, admin]
                  default: user
      responses:
        '201':
          description: Success
        '409':
          description: Email exists

  /auth/login:
    post:
      tags: [Authentication]
      summary: Login
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                password:
                  type: string
      responses:
        '200':
          description: Success with token

  # Users
  /users:
    get:
      tags: [Users]
      summary: Get all users
      responses:
        '200':
          description: List users

  /users/{id}:
    get:
      tags: [Users]
      summary: Get user by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: User data
    
    put:
      tags: [Users]
      summary: Update user
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Updated

    delete:
      tags: [Users]
      summary: Delete user
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Deleted

  # Places
  /places:
    get:
      tags: [Places]
      summary: Get approved places
      responses:
        '200':
          description: List places
    
    post:
      tags: [Places]
      summary: Add new place
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [name, location, owner_id]
              properties:
                name:
                  type: string
                location:
                  type: string
                description:
                  type: string
                owner_id:
                  type: string
                category:
                  type: string
                capacity:
                  type: number
                openHours:
                  type: string
                closeHours:
                  type: string
      responses:
        '201':
          description: Created

  /places/{id}:
    get:
      tags: [Places]
      summary: Get place by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Place data
    
    put:
      tags: [Places]
      summary: Update place
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Place updated
    
    delete:
      tags: [Places]
      summary: Delete place
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Place deleted

  /places/pending:
    get:
      tags: [Places]
      summary: Get pending places (Admin)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Pending places

  /places/{id}/approve:
    put:
      tags: [Places]
      summary: Approve/reject place (Admin)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [approved, rejected]
      responses:
        '200':
          description: Status updated

  # Bookings
  /bookings:
    get:
      tags: [Bookings]
      summary: Get all bookings
      responses:
        '200':
          description: List bookings
    
    post:
      tags: [Bookings]
      summary: Create booking
      parameters:
        - name: X-User-ID
          in: header
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [placeId, customerName, customerEmail, date, time]
              properties:
                placeId:
                  type: string
                customerName:
                  type: string
                customerEmail:
                  type: string
                capacity:
                  type: number
                date:
                  type: string
                time:
                  type: string
      responses:
        '201':
          description: Booking created

  /bookings/owner/{ownerId}:
    get:
      tags: [Bookings]
      summary: Get bookings by owner
      parameters:
        - name: ownerId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Owner bookings

  /bookings/{id}/status:
    put:
      tags: [Bookings]
      summary: Update booking status (Admin)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [pending, approved, rejected]
      responses:
        '200':
          description: Booking status updated

  /bookings/{id}:
    delete:
      tags: [Bookings]
      summary: Delete booking (Admin)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Booking deleted

  # Time API
  /time/palu:
    get:
      tags: [Time]
      summary: Get Palu time (WITA)
      responses:
        '200':
          description: Current Palu time
          content:
            application/json:
              schema:
                type: object
                properties:
                  timeString:
                    type: string
                    example: "20:46:30"
                  dateString:
                    type: string
                  timezone:
                    type: string
                    example: "WITA"
                  message:
                    type: string

  # Maps API
  /maps/geocode/{address}:
    get:
      tags: [Maps]
      summary: Geocode address to coordinates
      parameters:
        - name: address
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Coordinates found
          content:
            application/json:
              schema:
                type: object
                properties:
                  lat:
                    type: number
                  lng:
                    type: number
                  display_name:
                    type: string



components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT